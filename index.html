<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>OWNER-EX PRO TERMINAL</title>
    <script src="https://unpkg.com/lightweight-charts@3.8.0/dist/lightweight-charts.standalone.production.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg: #0b0e11; --panel: #161a1e; --accent: #00ffad;
            --red: #f6465d; --green: #0ecb81; --border: #2b2f36;
            --radius: 12px;
        }
        body, html { margin: 0; padding: 0; background: var(--bg); color: #eaecef; font-family: 'Inter', sans-serif; height: 100%; }
        
        .main-wrapper { display: flex; flex-direction: column; min-height: 100vh; }

        /* HEADER */
        header { 
            height: 65px; background: var(--panel); border-bottom: 1px solid var(--border); 
            display: flex; align-items: center; justify-content: space-between; padding: 0 20px; flex-shrink: 0;
        }
        .header-left { display: flex; align-items: center; gap: 20px; }
        .logo { font-weight: 900; color: var(--accent); font-size: 22px; letter-spacing: 1px; }

        .acc-toggle { display: flex; background: #000; border: 1px solid var(--border); padding: 3px; border-radius: 10px; }
        .acc-btn { padding: 6px 15px; border: none; background: none; color: #555; cursor: pointer; font-size: 12px; font-weight: bold; border-radius: 8px; transition: 0.3s; }
        .acc-btn.active { background: var(--accent); color: #000; }

        /* TERMINAL LAYOUT */
        .terminal-container { display: grid; grid-template-columns: 70px 1fr 300px; height: 650px; flex-shrink: 0; }
        
        .side-nav { background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding: 25px 0; gap: 30px; }
        .nav-item { font-size: 22px; color: #848e9c; cursor: pointer; transition: 0.3s; }
        .nav-item:hover { color: var(--accent); transform: scale(1.1); }

        .chart-section { display: flex; flex-direction: column; border-right: 1px solid var(--border); background: #000; overflow: hidden; }
        #chart { flex: 1; }
        
        .history-section { height: 200px; background: var(--panel); border-top: 1px solid var(--border); overflow-y: auto; padding: 15px; }
        .history-section h4 { margin: 0 0 10px 0; font-size: 13px; color: var(--accent); letter-spacing: 1px; }

        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        th { text-align: left; color: #848e9c; border-bottom: 1px solid var(--border); padding: 8px; }
        td { padding: 8px; border-bottom: 1px solid #222; }

        /* TRADE PANEL */
        .trade-panel { padding: 25px; background: var(--panel); display: flex; flex-direction: column; gap: 20px; }
        .input-group { background: var(--bg); border: 1px solid var(--border); padding: 12px; border-radius: var(--radius); }
        .input-group label { display: block; font-size: 11px; color: #848e9c; margin-bottom: 5px; }
        .input-group input { background: transparent; border: none; color: #fff; width: 100%; font-size: 20px; font-weight: bold; outline: none; }

        .btn-exec { height: 65px; border: none; border-radius: var(--radius); font-weight: 800; font-size: 18px; cursor: pointer; transition: 0.2s; }
        .btn-call { background: var(--green); color: #000; }
        .btn-put { background: var(--red); color: #fff; }

        /* FOOTER */
        footer { background: var(--panel); border-top: 1px solid var(--border); padding: 40px 20px; flex-grow: 1; }
        .footer-content { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1.5fr 1fr; gap: 50px; }

        /* MODALS */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 10000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(8px); }
        .modal-box { background: var(--panel); width: 450px; padding: 30px; border-radius: 20px; border: 1px solid var(--border); position: relative; }
        
        .tab-nav { display: flex; gap: 20px; border-bottom: 1px solid var(--border); margin-bottom: 20px; }
        .tab-link { padding: 10px 0; cursor: pointer; color: #555; font-weight: bold; font-size: 14px; }
        .tab-link.active { color: var(--accent); border-bottom: 2px solid var(--accent); }
        .tab-pane { display: none; }
        .tab-pane.active { display: block; }

        .faq-item { background: #1e2329; margin-bottom: 10px; border-radius: 10px; cursor: pointer; border: 1px solid var(--border); }
        .faq-q { padding: 15px; color: var(--accent); font-weight: bold; display: flex; justify-content: space-between; }
        .faq-a { padding: 0 15px 15px 15px; color: #ccc; font-size: 13px; display: none; line-height: 1.5; }
        .faq-item.active .faq-a { display: block; }

        select, .custom-input { background: #0b0e11; border: 1px solid var(--border); color: #fff; padding: 12px; border-radius: 8px; width: 100%; box-sizing: border-box; }
    </style>
</head>
<body>

<div class="main-wrapper">
    <header>
        <div class="header-left">
            <div class="logo">OWNER-EX</div>
            <select id="assetSelect" onchange="changeSymbol(this.value)" style="width: 130px;">
                <option value="BTCUSDT">BTC/USDT</option>
                <option value="ETHUSDT">ETH/USDT</option>
                <option value="SOLUSDT">SOL/USDT</option>
            </select>
            <select id="tfSelect" onchange="changeTimeframe(this.value)" style="width: 100px;">
                <optgroup label="–°–µ–∫—É–Ω–¥—ã">
                    <option value="1s">S10</option>
                    <option value="1s">S30</option>
                </optgroup>
                <optgroup label="–ú–∏–Ω—É—Ç—ã">
                    <option value="1m" selected>M1</option>
                    <option value="5m">M5</option>
                    <option value="15m">M15</option>
                </optgroup>
                <optgroup label="–ß–∞—Å—ã">
                    <option value="1h">H1</option>
                </optgroup>
            </select>
        </div>
        <div style="display: flex; align-items: center; gap: 20px;">
            <div class="acc-toggle">
                <button class="acc-btn active" id="demoBtn" onclick="switchAccount('demo')">DEMO</button>
                <button class="acc-btn" id="realBtn" onclick="switchAccount('real')">REAL</button>
            </div>
            <div id="balanceDisplay" style="font-weight: 900; color: var(--green); font-size: 20px; min-width: 120px; text-align: right;">$10,000.00</div>
        </div>
    </header>

    <div class="terminal-container">
        <div class="side-nav">
            <i class="fas fa-chart-area nav-item" onclick="closeModals()"></i>
            <i class="fas fa-wallet nav-item" onclick="openModal('cashierModal')"></i>
            <i class="fas fa-user-circle nav-item" onclick="openModal('profileModal')"></i>
            <i class="fas fa-headset nav-item" onclick="toggleChat()" style="margin-top: auto; color: var(--accent);"></i>
        </div>

        <div class="chart-section">
            <div id="chart"></div>
            <div class="history-section">
                <h4>–ò–°–¢–û–†–ò–Ø –¢–û–†–ì–û–í–õ–ò</h4>
                <table>
                    <thead>
                        <tr><th>–ê–∫—Ç–∏–≤</th><th>–¢–∏–ø</th><th>–°—É–º–º–∞</th><th>–í—Ö–æ–¥</th><th>–í—ã—Ö–æ–¥</th><th>–î–æ—Ö–æ–¥</th></tr>
                    </thead>
                    <tbody id="tradeHistoryBody"></tbody>
                </table>
            </div>
        </div>

        <div class="trade-panel">
            <div class="input-group">
                <label>–°–£–ú–ú–ê –ò–ù–í–ï–°–¢–ò–¶–ò–ò (USDT)</label>
                <input type="number" id="tradeAmount" value="100">
            </div>
            <div class="input-group">
                <label>–í–†–ï–ú–Ø –≠–ö–°–ü–ò–†–ê–¶–ò–ò (–°–ï–ö)</label>
                <input type="number" id="tradeTime" value="30">
            </div>
            <div style="text-align: center; margin: 10px 0;">
                <div style="color: gray; font-size: 12px;">–í–´–ü–õ–ê–¢–ê</div>
                <div style="font-size: 32px; font-weight: 900; color: var(--accent);">82%</div>
            </div>
            <button class="btn-exec btn-call" onclick="handleTrade('CALL')">–í–´–®–ï ‚Üë</button>
            <button class="btn-exec btn-put" onclick="handleTrade('PUT')">–ù–ò–ñ–ï ‚Üì</button>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div>
                <h3 style="color: #fff; margin-top: 0;">OWNER-EX PRO</h3>
                <p style="font-size: 13px; line-height: 1.6; color: #848e9c;">
                    –í–µ–¥—É—â–∞—è —Ç–æ—Ä–≥–æ–≤–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –∞–∫—Ç–∏–≤–æ–≤. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Å–∫–æ—Ä–æ—Å—Ç—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è ‚Äî –Ω–∞—à –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.
                </p>
                <a href="#" onclick="openModal('termsModal')" style="color: var(--accent); font-size: 12px; text-decoration: none;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ</a>
            </div>
            <div>
                <h3 style="color: #fff; margin-top: 0;">–ß–ê–°–¢–û –ó–ê–î–ê–í–ê–ï–ú–´–ï –í–û–ü–†–û–°–´</h3>
                <div class="faq-item" onclick="this.classList.toggle('active')">
                    <div class="faq-q">–ö–∞–∫ –ø–æ–ø–æ–ª–Ω–∏—Ç—å REAL –±–∞–ª–∞–Ω—Å? <i class="fas fa-plus"></i></div>
                    <div class="faq-a">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´–ö–ê–°–°–ê¬ª, –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∫–ª–∞–¥–∫—É ¬´–î–µ–ø–æ–∑–∏—Ç¬ª –∏ –≤–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.</div>
                </div>
                <div class="faq-item" onclick="this.classList.toggle('active')">
                    <div class="faq-q">–ö–∞–∫–∏–µ –ª–∏–º–∏—Ç—ã –Ω–∞ –≤—ã–≤–æ–¥? <i class="fas fa-plus"></i></div>
                    <div class="faq-a">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç $20. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—è–≤–æ–∫ –∑–∞–Ω–∏–º–∞–µ—Ç –æ—Ç 15 –º–∏–Ω—É—Ç –¥–æ 24 —á–∞—Å–æ–≤.</div>
                </div>
            </div>
            <div style="text-align: right;">
                <div style="background: #000; padding: 20px; border-radius: 15px; border: 1px solid var(--border);">
                    <h4 style="margin: 0 0 10px 0;">–ü–û–î–î–ï–†–ñ–ö–ê 24/7</h4>
                    <p style="font-size: 12px; color: gray;">–ù–∞—à–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –≥–æ—Ç–æ–≤—ã –ø–æ–º–æ—á—å –≤–∞–º –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è.</p>
                    <button onclick="toggleChat()" style="background: var(--accent); border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%;">–°–í–Ø–ó–ê–¢–¨–°–Ø</button>
                </div>
            </div>
        </div>
    </footer>
</div>

<div id="cashierModal" class="modal-overlay">
    <div class="modal-box">
        <div class="tab-nav">
            <div class="tab-link active" onclick="switchTab(event, 'dep-tab')">–î–ï–ü–û–ó–ò–¢</div>
            <div class="tab-link" onclick="switchTab(event, 'with-tab')">–í–´–í–û–î</div>
            <div class="tab-link" onclick="switchTab(event, 'cash-hist-tab')">–ò–°–¢–û–†–ò–Ø</div>
        </div>
        
        <div id="dep-tab" class="tab-pane active">
            <label style="font-size: 11px; color: gray;">–í–´–ë–ï–†–ò–¢–ï –ú–ï–¢–û–î</label>
            <select style="margin-bottom: 15px; margin-top: 5px;">
                <option>USDT TRC20 (Fast)</option>
                <option>–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞</option>
            </select>
            <input type="number" id="depositInput" class="custom-input" placeholder="–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è $">
            <button onclick="processDeposit()" class="btn-exec btn-call" style="width:100%; height:45px; margin-top:20px; font-size:14px;">–ü–û–ü–û–õ–ù–ò–¢–¨</button>
        </div>

        <div id="with-tab" class="tab-pane">
            <input type="text" id="withdrawWallet" class="custom-input" placeholder="–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ / –ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã" style="margin-bottom: 15px;">
            <input type="number" id="withdrawAmount" class="custom-input" placeholder="–°—É–º–º–∞ –≤—ã–≤–æ–¥–∞ $">
            <button onclick="processWithdraw()" class="btn-exec btn-put" style="width:100%; height:45px; margin-top:20px; font-size:14px;">–í–´–í–ï–°–¢–ò</button>
        </div>

        <div id="cash-hist-tab" class="tab-pane">
            <div style="max-height: 250px; overflow-y: auto;">
                <table>
                    <thead><tr><th>–î–∞—Ç–∞</th><th>–¢–∏–ø</th><th>–°—É–º–º–∞</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead>
                    <tbody id="cashHistoryBody"></tbody>
                </table>
            </div>
        </div>
        <button onclick="closeModals()" style="width:100%; margin-top:15px; background:none; border:none; color:gray; cursor:pointer;">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<div id="profileModal" class="modal-overlay">
    <div class="modal-box" style="width: 550px;">
        <h3 style="color: var(--accent); margin-top: 0;">–õ–ò–ß–ù–´–ï –î–ê–ù–ù–´–ï</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div><label style="font-size: 10px; color: gray;">–ò–ú–Ø</label><input type="text" id="p_name" class="custom-input"></div>
            <div><label style="font-size: 10px; color: gray;">–§–ê–ú–ò–õ–ò–Ø</label><input type="text" id="p_surname" class="custom-input"></div>
            <div><label style="font-size: 10px; color: gray;">–ù–ò–ö–ù–ï–ô–ú</label><input type="text" id="p_nick" class="custom-input"></div>
            <div><label style="font-size: 10px; color: gray;">–°–¢–†–ê–ù–ê</label><input type="text" id="p_country" class="custom-input"></div>
            <div><label style="font-size: 10px; color: gray;">–ì–û–†–û–î</label><input type="text" id="p_city" class="custom-input"></div>
            <div><label style="font-size: 10px; color: gray;">–î–ê–¢–ê –†–û–ñ–î–ï–ù–ò–Ø</label><input type="date" id="p_birth" class="custom-input" style="font-size: 12px;"></div>
        </div>
        <button onclick="saveProfile()" class="btn-exec btn-call" style="width:100%; height:45px; margin-top:20px; font-size:14px;">–°–û–•–†–ê–ù–ò–¢–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø</button>
        <button onclick="closeModals()" style="width:100%; margin-top:10px; background:none; border:none; color:gray; cursor:pointer;">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>

<div id="termsModal" class="modal-overlay">
    <div class="modal-box" style="width: 600px;">
        <h3 style="color: var(--accent);">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ</h3>
        <div style="font-size: 12px; color: #ccc; height: 300px; overflow-y: auto; line-height: 1.6; padding-right: 10px;">
            1. –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ OWNER-EX –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É—Å–ª—É–≥–∏ –ø–æ –∞–Ω–∞–ª–∏–∑—É —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.<br><br>
            2. –¢–æ—Ä–≥–æ–≤–ª—è –Ω–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ä—ã–Ω–∫–∞—Ö —Å–æ–ø—Ä—è–∂–µ–Ω–∞ —Å —Ä–∏—Å–∫–∞–º–∏. –ú—ã –Ω–µ –Ω–µ—Å–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –ø–æ—Ç–µ—Ä—é —Å—Ä–µ–¥—Å—Ç–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.<br><br>
            3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—è–∑—É–µ—Ç—Å—è —É–∫–∞–∑—ã–≤–∞—Ç—å –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏.<br><br>
            4. –ó–∞–ø—Ä–µ—â–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –¥–ª—è –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ –∫–æ—Ç–∏—Ä–æ–≤–∫–∞–º–∏.<br><br>
            5. –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞ —Å–æ–±–æ–π –ø—Ä–∞–≤–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç—ã –ø—Ä–∏ –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–∏ –≤ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–µ.
        </div>
        <button onclick="closeModals()" class="btn-exec btn-call" style="width:100%; height:45px; margin-top:20px;">–ü–†–ò–ù–Ø–¢–¨ –ò –ü–†–û–î–û–õ–ñ–ò–¢–¨</button>
    </div>
</div>

<script>
    // --- –ù–ê–°–¢–†–û–ô–ö–ò ---
    const TG_TOKEN = 8102627080:AAGGbjyR0g1VzICKb-ait4t3CA34PJz1g5M; 
    const TG_USER_ID = 6426834853;

    // --- TAWK.TO ---
    var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
    (function(){
        var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
        s1.async=true; s1.src='https://embed.tawk.to/695db9fa7f2f70197ba81bc8/1jeb1sv1v';
        s1.charset='UTF-8'; s1.setAttribute('crossorigin','*');
        s0.parentNode.insertBefore(s1,s0);
    })();
    function toggleChat() { if(Tawk_API.toggle) Tawk_API.toggle(); }

    // --- TELEGRAM ---
    async function sendTelegram(msg) {
        try {
            await fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ chat_id: TG_USER_ID, text: msg, parse_mode: "HTML" })
            });
        } catch(e) { console.error("TG Error:", e); }
    }

    // --- DATA STATE ---
    let bals = JSON.parse(localStorage.getItem('bals')) || { demo: 10000, real: 0 };
    let profile = JSON.parse(localStorage.getItem('profile')) || {};
    let tHist = JSON.parse(localStorage.getItem('tradeHistory')) || [];
    let cHist = JSON.parse(localStorage.getItem('cashHistory')) || [];
    let currentAccount = 'demo';
    let currentSymbol = 'BTCUSDT';
    let currentTimeframe = '1m';
    let lastPrice = 0;
    let chart, series;

    function saveAll() {
        localStorage.setItem('bals', JSON.stringify(bals));
        localStorage.setItem('profile', JSON.stringify(profile));
        localStorage.setItem('tradeHistory', JSON.stringify(tHist));
        localStorage.setItem('cashHistory', JSON.stringify(cHist));
    }

    function updateUI() {
        document.getElementById('balanceDisplay').innerText = `$${bals[currentAccount].toLocaleString()}`;
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–¥–µ–ª–æ–∫
        document.getElementById('tradeHistoryBody').innerHTML = tHist.map(h => `
            <tr>
                <td>${h.s}</td>
                <td style="color:${h.t === 'CALL' ? '#0ecb81' : '#f6465d'}">${h.t}</td>
                <td>$${h.a}</td>
                <td>${h.i}</td>
                <td>${h.o}</td>
                <td style="font-weight:bold; color:${h.r.includes('+') ? '#0ecb81' : '#f6465d'}">${h.r}</td>
            </tr>
        `).join('');

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∫–∞—Å—Å—ã
        document.getElementById('cashHistoryBody').innerHTML = cHist.map(h => `
            <tr><td>${h.d}</td><td>${h.t}</td><td>$${h.a}</td><td>${h.s}</td></tr>
        `).join('');
    }

    // --- –¢–û–†–ì–û–í–õ–Ø ---
    window.handleTrade = (type) => {
        let amount = Math.abs(parseFloat(document.getElementById('tradeAmount').value));
        let seconds = parseInt(document.getElementById('tradeTime').value);

        if (isNaN(amount) || amount <= 0 || bals[currentAccount] < amount) {
            return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—É–º–º–∞!");
        }

        bals[currentAccount] -= amount;
        updateUI();
        
        const entryPrice = lastPrice;
        const entryLine = series.createPriceLine({ 
            price: entryPrice, 
            color: type === 'CALL' ? '#0ecb81' : '#f6465d', 
            title: `–í–•–û–î ${type}` 
        });

        sendTelegram(`üöÄ <b>–°–¥–µ–ª–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞!</b>\n–¢–∏–ø: ${type}\n–°—É–º–º–∞: $${amount}\n–ê–∫–∫–∞—É–Ω—Ç: ${currentAccount.toUpperCase()}`);

        setTimeout(() => {
            const win = (type === 'CALL' && lastPrice > entryPrice) || (type === 'PUT' && lastPrice < entryPrice);
            const profit = win ? amount * 1.82 : 0;
            
            if (win) bals[currentAccount] += profit;
            
            const resultStr = win ? `+$${(profit - amount).toFixed(2)}` : `-$${amount}`;
            tHist.unshift({ s: currentSymbol, t: type, a: amount, i: entryPrice, o: lastPrice, r: resultStr });
            
            series.removePriceLine(entryLine);
            saveAll();
            updateUI();
            
            sendTelegram(`üèÅ <b>–ò—Ç–æ–≥ —Å–¥–µ–ª–∫–∏:</b> ${win ? '–í–´–ò–ì–†–´–® ‚úÖ' : '–ü–†–û–ò–ì–†–´–® ‚ùå'}\n–†–µ–∑—É–ª—å—Ç–∞—Ç: ${resultStr}\n–ë–∞–ª–∞–Ω—Å: $${bals[currentAccount].toFixed(2)}`);
        }, seconds * 1000);
    };

    // --- –ö–ê–°–°–ê –ò –ü–†–û–§–ò–õ–¨ ---
    window.switchAccount = (acc) => {
        currentAccount = acc;
        document.getElementById('demoBtn').classList.toggle('active', acc === 'demo');
        document.getElementById('realBtn').classList.toggle('active', acc === 'real');
        updateUI();
    };

    window.processDeposit = () => {
        let amt = Math.abs(parseFloat(document.getElementById('depositInput').value));
        if (amt > 0) {
            bals.real += amt;
            cHist.unshift({ d: new Date().toLocaleDateString(), t: '–î–µ–ø–æ–∑–∏—Ç', a: amt, s: '–£—Å–ø–µ—à–Ω–æ' });
            saveAll(); updateUI();
            sendTelegram(`üí≥ <b>–î–ï–ü–û–ó–ò–¢:</b> +$${amt}\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${profile.p_nick || 'Guest'}`);
            alert("–ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω!");
        }
    };

    window.processWithdraw = () => {
        let amt = Math.abs(parseFloat(document.getElementById('withdrawAmount').value));
        let wallet = document.getElementById('withdrawWallet').value;
        if (amt > bals.real || amt <= 0 || !wallet) return alert("–û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö!");
        
        bals.real -= amt;
        cHist.unshift({ d: new Date().toLocaleDateString(), t: '–í—ã–≤–æ–¥', a: amt, s: '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ' });
        saveAll(); updateUI();
        sendTelegram(`üí∞ <b>–ó–ê–Ø–í–ö–ê –ù–ê –í–´–í–û–î:</b> $${amt}\n–ö—É–¥–∞: ${wallet}\n–ù–∏–∫: ${profile.p_nick || 'Guest'}`);
        alert("–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞ –≤ –æ–±—Ä–∞–±–æ—Ç–∫—É!");
    };

    window.saveProfile = () => {
        profile = {
            p_name: document.getElementById('p_name').value,
            p_surname: document.getElementById('p_surname').value,
            p_nick: document.getElementById('p_nick').value,
            p_country: document.getElementById('p_country').value,
            p_city: document.getElementById('p_city').value,
            p_birth: document.getElementById('p_birth').value
        };
        saveAll();
        sendTelegram(`üë§ <b>–ü–†–û–§–ò–õ–¨ –û–ë–ù–û–í–õ–ï–ù:</b>\n–ù–∏–∫: ${profile.p_nick}\n–ò–º—è: ${profile.p_name} ${profile.p_surname}`);
        alert("–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!");
    };

    // --- –ì–†–ê–§–ò–ö ---
    function initChart() {
        if(chart) document.getElementById('chart').innerHTML = '';
        chart = LightweightCharts.createChart(document.getElementById('chart'), {
            layout: { background: { color: '#000' }, textColor: '#848e9c' },
            grid: { vertLines: { color: '#111' }, horzLines: { color: '#111' } },
            timeScale: { timeVisible: true, secondsVisible: true }
        });
        series = chart.addCandlestickSeries({ upColor: '#0ecb81', downColor: '#f6465d' });
        loadChartData();
    }

    async function loadChartData() {
        const fetchTF = currentTimeframe === '1s' ? '1m' : currentTimeframe;
        const r = await fetch(`https://api.binance.com/api/v3/klines?symbol=${currentSymbol}&interval=${fetchTF}&limit=500`);
        const d = await r.json();
        series.setData(d.map(x => ({ time: x[0]/1000, open: +x[1], high: +x[2], low: +x[3], close: +x[4] })));
        
        if(window.ws) window.ws.close();
        window.ws = new WebSocket(`wss://stream.binance.com:9443/ws/${currentSymbol.toLowerCase()}@kline_1s`);
        window.ws.onmessage = e => {
            const k = JSON.parse(e.data).k; lastPrice = +k.c;
            series.update({ time: k.t/1000, open: +k.o, high: +k.h, low: +k.l, close: lastPrice });
        };
    }

    window.changeSymbol = (s) => { currentSymbol = s; loadChartData(); };
    window.changeTimeframe = (t) => { currentTimeframe = t; loadChartData(); };

    // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–µ ---
    window.openModal = (id) => {
        document.getElementById(id).style.display = 'flex';
        if(id === 'profileModal') {
            document.getElementById('p_name').value = profile.p_name || '';
            document.getElementById('p_surname').value = profile.p_surname || '';
            document.getElementById('p_nick').value = profile.p_nick || '';
            document.getElementById('p_country').value = profile.p_country || '';
            document.getElementById('p_city').value = profile.p_city || '';
            document.getElementById('p_birth').value = profile.p_birth || '';
        }
    };
    window.closeModals = () => document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none');
    window.switchTab = (e, id) => {
        const parent = e.target.parentElement;
        parent.querySelectorAll('.tab-link').forEach(l => l.classList.remove('active'));
        parent.parentElement.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
        e.target.classList.add('active');
        document.getElementById(id).classList.add('active');
    };

    initChart();
    updateUI();
</script>
</body>
</html>
